<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Welcome to 123 Main Street</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&display=swap" rel="stylesheet" />
</head>
<body>
  <header class="fade-in">
    <h1 class="section-heading">01 Welcome</h1>
    <p class="main-text">Welcome to 123 Main Street</p>
    <p class="sub-text">Letâ€™s curate your dream vacation in [City Name]</p>
  </header>

  <main id="experience-list" class="fade-in">
    <!-- Dynamic Experiences will be injected here -->
  </main>

  <footer class="fade-in">
    <p class="footer-note">Powered by Unified Content</p>
  </footer>

  <script>
  console.log('Loading script...');

  fetch('/.netlify/functions/get-experiences')
    .then(res => {
      console.log('Fetch response:', res);
      if (!res.ok) {
        throw new Error(`HTTP error! status: ${res.status}`);
      }
      return res.json();
    })
    .then(data => {
      console.log('Data received:', data);
      const container = document.getElementById('experience-list');

      if (!data.records || data.records.length === 0) {
        console.error('No records found.');
        container.innerHTML = '<p style="color:red;">No experiences found.</p>';
        return;
      }

      // Clear any old content
      container.innerHTML = '';

      data.records.forEach(record => {
  const fields = record.fields || {};

  const name = fields.Name || 'Untitled Experience';
  const description = fields.Description || 'No description provided.';
  const rawUrl = fields.URL || '#';
  const url = rawUrl.startsWith('http') ? rawUrl : `https://${rawUrl}`;
  const imageUrl =
    fields.Photo && fields.Photo.length > 0 && fields.Photo[0].thumbnails
      ? fields.Photo[0].thumbnails.small.url
      : null;

  const div = document.createElement('div');
  div.className = 'experience-card fade-in';
  div.style.border = '1px solid black';
  div.style.margin = '10px';
  div.style.padding = '10px';
  div.style.backgroundColor = '#f8f8f8';

  div.innerHTML = `
${imageUrl ? `<img src="${imageUrl}" alt="${name}" class="experience-image" />` : ''}
    <h2 style="font-size:20px;">${name}</h2>
    <p>${description}</p>
    ${url !== '#' ? `<a href="${url}" target="_blank" style="color:blue;">Book Now</a>` : '<span>No booking link available.</span>'}
  `;

  container.appendChild(div);
  div.classList.add('visible'); // Skip IntersectionObserver, load on page load
});
    })
    .catch(error => {
      console.error('Error fetching experiences:', error);
      const container = document.getElementById('experience-list');
      container.innerHTML = `<p style="color:red;">Failed to load experiences: ${error.message}</p>`;
    });

  // Fade-in on scroll
  const observer = new IntersectionObserver(entries => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('visible');
        observer.unobserve(entry.target);
      }
    });
  }, { threshold: 0.1 });

  document.querySelectorAll('.fade-in').forEach(el => observer.observe(el));
</script>
</body>
</html>
