<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Welcome to 123 Main Street</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Helvetica+Neue:wght@400;500;700;900&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
</head>
<body>
  <header>
    <div class="container">
      <div class="header-content">
        <h1 class="title-prefix">01 <span class="title-separator"></span> EXPERIENCES</h1>
        <h2 class="main-title">Welcome to 123 Main Street</h2>
        <p class="subtitle">Let's curate your dream vacation in Los Angeles</p>
      </div>
    </div>
  </header>
  
  <div class="search-hero">
    <div class="container search-container">
      <div class="search-wrapper">
        <div class="search-bar">
          <i class="fas fa-search search-icon"></i>
          <input 
            type="text" 
            id="search-input" 
            class="search-input" 
            placeholder="Search experiences..." 
            aria-label="Search experiences"
          >
        </div>
        
        <button id="toggle-filters" class="toggle-filters-btn">
          <i class="fas fa-sliders-h"></i> Filters
        </button>
      </div>
      
      <div id="filters-panel" class="filters-panel">
        <div class="filters-row">
          <div class="filter-group">
            <label for="category-filter" class="filter-label">
              <i class="fas fa-tag"></i> Category
            </label>
            <select id="category-filter">
              <option value="all">All Categories</option>
            </select>
          </div>
          
          <div class="filter-group">
            <label for="location-filter" class="filter-label">
              <i class="fas fa-map-marker-alt"></i> Location
            </label>
            <select id="location-filter">
              <option value="all">All Locations</option>
            </select>
          </div>
          
          <div class="filter-group">
            <label for="audience-filter" class="filter-label">
              <i class="fas fa-users"></i> Audience
            </label>
            <select id="audience-filter">
              <option value="all">All Types</option>
            </select>
          </div>
        </div>
        
        <div class="filters-row">
          <div class="filter-group">
            <label for="price-filter" class="filter-label">
              <i class="fas fa-dollar-sign"></i> Price
            </label>
            <select id="price-filter">
              <option value="all">Any Price</option>
              <option value="0-50">Under $50</option>
              <option value="50-100">$50 - $100</option>
              <option value="100-200">$100 - $200</option>
              <option value="200+">$200+</option>
            </select>
          </div>
          
          <div class="filter-group">
            <label for="duration-filter" class="filter-label">
              <i class="fas fa-clock"></i> Duration
            </label>
            <select id="duration-filter">
              <option value="all">Any Duration</option>
              <option value="1">1 hour</option>
              <option value="2">2 hours</option>
              <option value="3">3 hours</option>
              <option value="4+">4+ hours</option>
            </select>
          </div>
          
          <div class="filter-group">
            <label for="sort-by" class="filter-label">
              <i class="fas fa-sort"></i> Sort by
            </label>
            <select id="sort-by">
              <option value="name">Name (A-Z)</option>
              <option value="name-desc">Name (Z-A)</option>
              <option value="price-asc">Price (Low to High)</option>
              <option value="price-desc">Price (High to Low)</option>
              <option value="duration-asc">Duration (Short to Long)</option>
              <option value="duration-desc">Duration (Long to Short)</option>
            </select>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="results-summary container">
    <p id="results-count" class="results-count">Showing all experiences</p>
  </div>
  
  <div id="loading-spinner" class="loading-spinner">
    <div class="spinner"></div>
  </div>
  
  <main>
    <div class="container">
      <div id="experience-list" class="experience-grid">
        <!-- Dynamic Experiences will be injected here -->
      </div>
      
      <div id="no-results" class="no-results hidden">
        <div class="no-results-icon">
          <i class="fas fa-search"></i>
        </div>
        <h3>No experiences found</h3>
        <p>Try adjusting your filters or search terms</p>
      </div>
    </div>
  </main>
  
  <footer>
    <div class="container">
      <p class="footer-note">Powered by Unified Content</p>
    </div>
  </footer>
  
  <script>
    // Global variables
    let allRecords = [];
    let filteredRecords = [];
    const searchDebounceDelay = 300;
    let searchDebounceTimer;
    
    // DOM elements
    const experienceList = document.getElementById('experience-list');
    const searchInput = document.getElementById('search-input');
    const categoryFilter = document.getElementById('category-filter');
    const locationFilter = document.getElementById('location-filter');
    const audienceFilter = document.getElementById('audience-filter');
    const priceFilter = document.getElementById('price-filter');
    const durationFilter = document.getElementById('duration-filter');
    const sortBySelect = document.getElementById('sort-by');
    const loadingSpinner = document.getElementById('loading-spinner');
    const resultsCount = document.getElementById('results-count');
    const noResultsDiv = document.getElementById('no-results');
    const toggleFiltersBtn = document.getElementById('toggle-filters');
    const filtersPanel = document.getElementById('filters-panel');
    
    // Initialize the app
    function init() {
      setupEventListeners();
      fetchExperiences();
      animateElements();
    }
    
    // Set up event listeners for filters and search
    function setupEventListeners() {
      // Search input with debounce
      searchInput.addEventListener('input', () => {
        clearTimeout(searchDebounceTimer);
        searchDebounceTimer = setTimeout(() => {
          applyFilters();
        }, searchDebounceDelay);
      });
      
      // Filter selects
      categoryFilter.addEventListener('change', applyFilters);
      locationFilter.addEventListener('change', applyFilters);
      audienceFilter.addEventListener('change', applyFilters);
      priceFilter.addEventListener('change', applyFilters);
      durationFilter.addEventListener('change', applyFilters);
      sortBySelect.addEventListener('change', applyFilters);
      
      // Toggle filters panel
      toggleFiltersBtn.addEventListener('click', () => {
        filtersPanel.classList.toggle('active');
        toggleFiltersBtn.classList.toggle('active');
      });
      
      // Focus animation for search input
      searchInput.addEventListener('focus', () => {
        document.querySelector('.search-bar').classList.add('focused');
      });
      
      searchInput.addEventListener('blur', () => {
        document.querySelector('.search-bar').classList.remove('focused');
      });
      
      // Scroll animations
      window.addEventListener('scroll', () => {
        const scrollPosition = window.scrollY;
        const header = document.querySelector('header');
        
        if (scrollPosition > 50) {
          header.classList.add('scrolled');
        } else {
          header.classList.remove('scrolled');
        }
      });
    }
    
    // Animate elements on page load
    function animateElements() {
      const elementsToAnimate = document.querySelectorAll('.animate-in');
      
      elementsToAnimate.forEach((element, index) => {
        setTimeout(() => {
          element.classList.add('visible');
        }, index * 100);
      });
    }
    
    // Fetch experiences data from Netlify function
    function fetchExperiences() {
      showLoading(true);
      
      // For demo purposes, we'll create sample data
      setTimeout(() => {
        const sampleData = {
          records: [
            {
              id: '1',
              fields: {
                Name: 'Hollywood Sign Hike',
                Description: 'Experience the iconic Hollywood Sign up close with this guided hike through Griffith Park.',
                Category: 'Outdoor',
                Location: 'Hollywood Hills',
                'Audience Type': 'Active',
                'Estimated Price': '25',
                Duration: '2',
                URL: 'https://example.com/hike'
              }
            },
            {
              id: '2',
              fields: {
                Name: 'LACMA Art Tour',
                Description: 'Explore the extensive collection at the Los Angeles County Museum of Art with an expert guide.',
                Category: 'Arts & Culture',
                Location: 'Mid-Wilshire',
                'Audience Type': 'Art Lovers',
                'Estimated Price': '35',
                Duration: '3',
                URL: 'https://example.com/lacma'
              }
            },
            {
              id: '3',
              fields: {
                Name: 'Santa Monica Sunset Bike Tour',
                Description: 'Cycle along the famous Santa Monica beach as the sun sets over the Pacific.',
                Category: 'Outdoor',
                Location: 'Santa Monica',
                'Audience Type': 'Active',
                'Estimated Price': '45',
                Duration: '2',
                URL: 'https://example.com/bike'
              }
            },
            {
              id: '4',
              fields: {
                Name: 'Michelin Star Dining Experience',
                Description: 'Indulge in a multi-course tasting menu at one of LA\'s finest restaurants.',
                Category: 'Food & Drink',
                Location: 'Downtown LA',
                'Audience Type': 'Foodies',
                'Estimated Price': '250',
                Duration: '3',
                URL: 'https://example.com/dining'
              }
            },
            {
              id: '5',
              fields: {
                Name: 'Warner Bros. Studio Tour',
                Description: 'Go behind the scenes of your favorite movies and TV shows with this exclusive studio tour.',
                Category: 'Entertainment',
                Location: 'Burbank',
                'Audience Type': 'All Ages',
                'Estimated Price': '75',
                Duration: '3',
                URL: 'https://example.com/studio'
              }
            },
            {
              id: '6',
              fields: {
                Name: 'Venice Beach Skateboarding Lesson',
                Description: 'Learn to skateboard from the pros at the famous Venice Beach Skatepark.',
                Category: 'Sport',
                Location: 'Venice',
                'Audience Type': 'Active',
                'Estimated Price': '60',
                Duration: '1',
                URL: 'https://example.com/skate'
              }
            }
          ]
        };
        
        console.log('âœ… Data received:', sampleData);
        
        if (!sampleData.records || sampleData.records.length === 0) {
          showNoResults('No experiences found in the database.');
          return;
        }
        
        allRecords = sampleData.records;
        populateFilterOptions();
        applyFilters();
        
        // Initial animation
        animateElements();
        
        showLoading(false);
      }, 1000);
    }
    
    // Populate filter dropdowns with options from data
    function populateFilterOptions() {
      // Extract unique values for each filter
      const categories = new Set();
      const locations = new Set();
      const audienceTypes = new Set();
      
      allRecords.forEach(record => {
        const fields = record.fields || {};
        
        // Add values to sets if they exist
        if (fields.Category) categories.add(fields.Category);
        if (fields.Location) locations.add(fields.Location);
        if (fields['Audience Type']) audienceTypes.add(fields['Audience Type']);
      });
      
      // Populate category filter
      populateSelectOptions(categoryFilter, [...categories].sort());
      
      // Populate location filter
      populateSelectOptions(locationFilter, [...locations].sort());
      
      // Populate audience filter
      populateSelectOptions(audienceFilter, [...audienceTypes].sort());
    }
    
    // Helper to populate select options
    function populateSelectOptions(selectElement, options) {
      options.forEach(option => {
        const optionElement = document.createElement('option');
        optionElement.value = option;
        optionElement.textContent = option;
        selectElement.appendChild(optionElement);
      });
    }
    
    // Apply all filters and sorting
    function applyFilters() {
      // Get filter values
      const searchTerm = searchInput.value.toLowerCase().trim();
      const selectedCategory = categoryFilter.value;
      const selectedLocation = locationFilter.value;
      const selectedAudience = audienceFilter.value;
      const selectedPrice = priceFilter.value;
      const selectedDuration = durationFilter.value;
      const sortBy = sortBySelect.value;
      
      // Filter records
      filteredRecords = allRecords.filter(record => {
        const fields = record.fields || {};
        const name = (fields.Name || '').toLowerCase();
        const description = (fields.Description || '').toLowerCase();
        const category = fields.Category || '';
        const location = fields.Location || '';
        const audience = fields['Audience Type'] || '';
        const price = parseFloat(fields['Estimated Price'] || 0);
        const duration = parseInt(fields.Duration || 0);
        
        // Text search
        const matchesSearch = !searchTerm || 
          name.includes(searchTerm) || 
          description.includes(searchTerm);
        
        // Category filter
        const matchesCategory = selectedCategory === 'all' || 
          category === selectedCategory;
        
        // Location filter
        const matchesLocation = selectedLocation === 'all' || 
          location === selectedLocation;
        
        // Audience filter
        const matchesAudience = selectedAudience === 'all' || 
          audience === selectedAudience;
        
        // Price filter
        let matchesPrice = true;
        if (selectedPrice !== 'all') {
          if (selectedPrice === '0-50') {
            matchesPrice = price >= 0 && price <= 50;
          } else if (selectedPrice === '50-100') {
            matchesPrice = price > 50 && price <= 100;
          } else if (selectedPrice === '100-200') {
            matchesPrice = price > 100 && price <= 200;
          } else if (selectedPrice === '200+') {
            matchesPrice = price > 200;
          }
        }
        
        // Duration filter
        let matchesDuration = true;
        if (selectedDuration !== 'all') {
          if (selectedDuration === '4+') {
            matchesDuration = duration >= 4;
          } else {
            matchesDuration = duration === parseInt(selectedDuration);
          }
        }
        
        // Return true if it matches all filters
        return matchesSearch && 
               matchesCategory && 
               matchesLocation && 
               matchesAudience && 
               matchesPrice && 
               matchesDuration;
      });
      
      // Sort filtered records
      sortFilteredRecords(sortBy);
      
      // Update results count
      updateResultsCount();
      
      // Render the filtered and sorted records
      renderExperienceCards();
    }
    
    // Update the results count display
    function updateResultsCount() {
      let countText = '';
      
      if (filteredRecords.length === 0) {
        countText = 'No experiences found';
      } else if (filteredRecords.length === 1) {
        countText = '1 experience found';
      } else {
        countText = `${filteredRecords.length} experiences found`;
      }
      
      // Check if filters are applied
      const hasSearch = searchInput.value.trim() !== '';
      const hasCategory = categoryFilter.value !== 'all';
      const hasLocation = locationFilter.value !== 'all';
      const hasAudience = audienceFilter.value !== 'all';
      const hasPrice = priceFilter.value !== 'all';
      const hasDuration = durationFilter.value !== 'all';
      
      const filtersApplied = hasSearch || hasCategory || hasLocation || 
                            hasAudience || hasPrice || hasDuration;
      
      if (filtersApplied) {
        countText += ' with current filters';
      }
      
      resultsCount.textContent = countText;
    }
    
    // Sort the filtered records based on selected sort option
    function sortFilteredRecords(sortBy) {
      filteredRecords.sort((a, b) => {
        const fieldsA = a.fields || {};
        const fieldsB = b.fields || {};
        
        switch (sortBy) {
          case 'name':
            return (fieldsA.Name || '').localeCompare(fieldsB.Name || '');
          case 'name-desc':
            return (fieldsB.Name || '').localeCompare(fieldsA.Name || '');
          case 'price-asc':
            return parseFloat(fieldsA['Estimated Price'] || 0) - parseFloat(fieldsB['Estimated Price'] || 0);
          case 'price-desc':
            return parseFloat(fieldsB['Estimated Price'] || 0) - parseFloat(fieldsA['Estimated Price'] || 0);
          case 'duration-asc':
            return parseInt(fieldsA.Duration || 0) - parseInt(fieldsB.Duration || 0);
          case 'duration-desc':
            return parseInt(fieldsB.Duration || 0) - parseInt(fieldsA.Duration || 0);
          default:
            return 0;
        }
      });
    }
    
    // Render experience cards
    function renderExperienceCards() {
      // Clear the container
      experienceList.innerHTML = '';
      
      if (filteredRecords.length === 0) {
        noResultsDiv.classList.remove('hidden');
        experienceList.classList.add('hidden');
        return;
      } else {
        noResultsDiv.classList.add('hidden');
        experienceList.classList.remove('hidden');
      }
      
      // Add cards for each filtered record
      filteredRecords.forEach((record, index) => {
        const fields = record.fields || {};
        
        // Extract field values with fallbacks
        const name = fields.Name || 'Untitled Experience';
        const description = fields.Description || 'No description provided.';
        const rawUrl = fields.URL || '#';
        const url = rawUrl.startsWith('http') ? rawUrl : `https://${rawUrl}`;
        const category = fields.Category || '';
        const location = fields.Location || '';
        const audienceType = fields['Audience Type'] || '';
        const price = fields['Estimated Price'] 
          ? `$${parseFloat(fields['Estimated Price']).toFixed(0)}` 
          : 'Price not available';
        const duration = fields.Duration 
          ? `${fields.Duration} ${parseInt(fields.Duration) === 1 ? 'hour' : 'hours'}` 
          : '';
        
        // Create placeholder image (would be replaced with actual images in production)
        const cardColors = ['#f3f4f6', '#e5e7eb', '#d1d5db', '#f0fdf4', '#f0f9ff', '#fef3c7'];
        const colorIndex = index % cardColors.length;
        const placeholderBg = cardColors[colorIndex];
        
        // Create card element
        const card = document.createElement('a');
        card.href = url;
        card.target = "_blank";
        card.className = 'experience-card animate-in';
        card.style.setProperty('--delay', `${index * 0.05}s`);
        
        // Generate a placeholder icon based on category
        let categoryIcon = 'fa-ticket';
        if (category === 'Food & Drink') categoryIcon = 'fa-utensils';
        if (category === 'Outdoor') categoryIcon = 'fa-mountain';
        if (category === 'Arts & Culture') categoryIcon = 'fa-palette';
        if (category === 'Entertainment') categoryIcon = 'fa-film';
        if (category === 'Sport') categoryIcon = 'fa-basketball';
        
        // Build card HTML
        let cardHTML = `
          <div class="card-image" style="background-color: ${placeholderBg}">
            <i class="fas ${categoryIcon} category-icon"></i>
            ${index < 3 ? '<span class="featured-tag">Featured</span>' : ''}
          </div>
          <div class="card-content">
            <div class="card-meta">
              ${category ? `<span class="badge badge-category">${category}</span>` : ''}
            </div>
            <h3 class="card-title">${name}</h3>
            <div class="card-details">
              ${location ? `<span class="card-location"><i class="fas fa-map-marker-alt"></i> ${location}</span>` : ''}
              ${price ? `<span class="card-price">${price}</span>` : ''}
              ${duration ? `<span class="card-duration"><i class="fas fa-clock"></i> ${duration}</span>` : ''}
            </div>
          </div>
        `;
        
        card.innerHTML = cardHTML;
        experienceList.appendChild(card);
        
        // Add visible class for animation
        setTimeout(() => {
          card.classList.add('visible');
        }, 50);
      });
    }
    
    // Show loading spinner
    function showLoading(isLoading) {
      if (isLoading) {
        loadingSpinner.classList.remove('hidden');
      } else {
        loadingSpinner.classList.add('hidden');
      }
    }
    
    // Show message when no results
    function showNoResults(visible) {
      if (visible) {
        noResultsDiv.classList.remove('hidden');
        experienceList.classList.add('hidden');
      } else {
        noResultsDiv.classList.add('hidden');
        experienceList.classList.remove('hidden');
      }
    }
    
    // Start the app when the DOM is fully loaded
    document.addEventListener('DOMContentLoaded', init);
    // Backup init in case DOMContentLoaded already fired
    if (document.readyState === 'interactive' || document.readyState === 'complete') {
      init();
    }
  </script>
</body>
</html>
