<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Welcome to 123 Main Street</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&display=swap" rel="stylesheet" />
</head>
<body>
  <header class="fade-in">
    <h1 class="section-heading">01 Welcome</h1>
    <p class="main-text">Welcome to 123 Main Street</p>
    <p class="sub-text">Let’s curate your dream vacation in [City Name]</p>
  </header>

  <section id="filter-controls" class="fade-in" style="padding: 1rem 1.5rem;">
    <label for="tag-filter">Filter by Tag:</label>
    <select id="tag-filter">
      <option value="all">All</option>
    </select>
  </section>

  <main id="experience-list" class="fade-in">
    <!-- Dynamic Experiences will be injected here -->
  </main>

  <footer class="fade-in">
    <p class="footer-note">Powered by Unified Content</p>
  </footer>

  <script>
  let allRecords = [];

  function renderCards(records) {
    const container = document.getElementById('experience-list');
    container.innerHTML = '';

    records.forEach(record => {
      const fields = record.fields;

      const name = fields.Name || 'Untitled Experience';
      const description = fields.Description || 'No description provided.';
      const rawUrl = fields.URL || '#';
      const url = rawUrl.startsWith('http') ? rawUrl : `https://${rawUrl}`;
      const imageUrl =
        fields.Photo && fields.Photo.length > 0 && fields.Photo[0].thumbnails
          ? fields.Photo[0].thumbnails.small.url
          : null;

      const div = document.createElement('div');
      div.className = 'experience-card fade-in visible';

      div.innerHTML = `
        ${imageUrl ? `<img src="${imageUrl}" alt="${name}" class="experience-image" />` : ''}
        <h2 class="experience-title">${name}</h2>
        <p class="experience-desc">${description}</p>
        ${url !== '#' ? `<a href="${url}" class="experience-link" target="_blank">Book Now</a>` : '<span>No booking link available.</span>'}
      `;

      container.appendChild(div);
    });
  }

  function populateFilterOptions(records) {
    const select = document.getElementById('tag-filter');
const tags = new Set(records
  .map(r => r.fields && r.fields.CATEGORY)
  .filter(Boolean));
    [...tags].sort().forEach(tag => {
      const option = document.createElement('option');
      option.value = tag;
      option.textContent = tag;
      select.appendChild(option);
    });
  }

  function setupFilter() {
    const select = document.getElementById('tag-filter');
    select.addEventListener('change', () => {
      const selected = select.value;
      const filtered = selected === 'all'
        ? allRecords
        : allRecords.filter(r => r.fields.CATEGORY === selected);
      renderCards(filtered);
    });
  }

 document.addEventListener('DOMContentLoaded', function() {
  fetch('/.netlify/functions/get-experiences')
    .then(res => res.ok ? res.json() : Promise.reject(`HTTP ${res.status}`))
    .then(data => {
      console.log('✅ Data received:', data);

      if (!data.records || data.records.length === 0) {
        console.error('⚠️ No experiences found');
        document.getElementById('experience-list').innerHTML =
          `<p style="color:red;">No experiences found.</p>`;
        return;
      }

      allRecords = data.records;
      renderCards(allRecords);
      populateFilterOptions(allRecords);
      setupFilter();
    })
    .catch(err => {
      console.error('❌ Failed to load experiences:', err);
      document.getElementById('experience-list').innerHTML =
        `<p style="color:red;">Failed to load experiences.</p>`;
    });
});
</script>
</body>
</html>
